<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataGridPaginator Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .test-header {
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .test-title {
            font-size: 2rem;
            color: #333;
            margin: 0;
        }
        
        .test-description {
            color: #666;
            margin: 10px 0 0 0;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-1px);
        }
        
        .test-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        
        .test-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .status-idle {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }
        
        .status-running {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffcc02;
        }
        
        .status-passed {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .status-failed {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .data-preview {
            background: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">üß™ DataGridPaginator Unit Tests</h1>
            <p class="test-description">
                Comprehensive tests for the soft delete functionality and filtering behavior.
                These tests will help identify what's preventing records from being updated correctly.
            </p>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="runAllTests">
                <span class="loader" id="testLoader"></span>
                üöÄ Run All Tests
            </button>
            <button class="btn btn-secondary" id="runFilterTests">
                üîç Run Filter Tests Only
            </button>
            <button class="btn btn-secondary" id="runSoftDeleteTests">
                üóëÔ∏è Run Soft Delete Tests Only
            </button>
            <button class="btn btn-success" id="clearOutput">
                üßπ Clear Output
            </button>
        </div>
        
        <div class="test-status status-idle" id="testStatus">
            <strong>Status:</strong> Ready to run tests
        </div>
        
        <div class="test-output" id="testOutput">Click "Run All Tests" to start testing...</div>
        
        <div class="test-grid">
            <div class="test-section">
                <h3>üìä Test Data Preview</h3>
                <div class="data-preview" id="testDataPreview">Loading...</div>
            </div>
            <div class="test-section">
                <h3>üìã Schema Preview</h3>
                <div class="data-preview" id="schemaPreview">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Import DataGridPaginator and Tests -->
    <script type="module">
        import { DataGridPaginator } from '../datagridpaginator.js';
        
        // Make DataGridPaginator globally available for tests
        window.DataGridPaginator = DataGridPaginator;
        
        console.log('‚úÖ DataGridPaginator imported successfully');
        
        // Load and run tests
        async function loadTests() {
            try {
                const response = await fetch('./datagrid-tests.js');
                const testCode = await response.text();
                
                // Execute the test code
                eval(testCode);
                
                console.log('‚úÖ Tests loaded successfully');
                
                // Display test data and schema
                displayDataPreviews();
                
                // Set up event listeners
                setupEventListeners();
                
            } catch (error) {
                console.error('‚ùå Error loading tests:', error);
                document.getElementById('testOutput').textContent = `Error loading tests: ${error.message}`;
                updateTestStatus('failed', 'Failed to load tests');
            }
        }
        
        function displayDataPreviews() {
            if (window.DataGridTests) {
                document.getElementById('testDataPreview').textContent = 
                    JSON.stringify(window.DataGridTests.testData, null, 2);
                document.getElementById('schemaPreview').textContent = 
                    JSON.stringify(window.DataGridTests.testSchema, null, 2);
            }
        }
        
        function setupEventListeners() {
            document.getElementById('runAllTests').addEventListener('click', runAllTests);
            document.getElementById('runFilterTests').addEventListener('click', runFilterTests);
            document.getElementById('runSoftDeleteTests').addEventListener('click', runSoftDeleteTests);
            document.getElementById('clearOutput').addEventListener('click', clearOutput);
        }
        
        async function runAllTests() {
            if (!window.DataGridTests) {
                showError('Tests not loaded properly');
                return;
            }
            
            updateTestStatus('running', 'Running all tests...');
            showLoader(true);
            
            // Capture console output
            captureConsoleOutput();
            
            try {
                await window.DataGridTests.runAllTests();
                updateTestStatus('passed', 'All tests completed');
            } catch (error) {
                updateTestStatus('failed', `Tests failed: ${error.message}`);
            } finally {
                showLoader(false);
                restoreConsoleOutput();
            }
        }
        
        async function runFilterTests() {
            if (!window.DataGridTests) {
                showError('Tests not loaded properly');
                return;
            }
            
            updateTestStatus('running', 'Running filter tests...');
            showLoader(true);
            
            captureConsoleOutput();
            
            try {
                const framework = window.DataGridTests.testFramework;
                
                // Run only filter-related tests
                const filterTests = framework.tests.filter(test => 
                    test.description.toLowerCase().includes('filter') ||
                    test.description.toLowerCase().includes('search') ||
                    test.description.toLowerCase().includes('toggle')
                );
                
                console.log(`üß™ Running ${filterTests.length} filter tests...\n`);
                
                for (const test of filterTests) {
                    try {
                        console.log(`üî∏ Running: ${test.description}`);
                        await test.testFn();
                        console.log(`‚úÖ PASSED: ${test.description}`);
                    } catch (error) {
                        console.error(`‚ùå FAILED: ${test.description}`);
                        console.error(`   Error: ${error.message}`);
                    }
                }
                
                updateTestStatus('passed', 'Filter tests completed');
            } catch (error) {
                updateTestStatus('failed', `Filter tests failed: ${error.message}`);
            } finally {
                showLoader(false);
                restoreConsoleOutput();
            }
        }
        
        async function runSoftDeleteTests() {
            if (!window.DataGridTests) {
                showError('Tests not loaded properly');
                return;
            }
            
            updateTestStatus('running', 'Running soft delete tests...');
            showLoader(true);
            
            captureConsoleOutput();
            
            try {
                const framework = window.DataGridTests.testFramework;
                
                // Run only soft delete related tests
                const softDeleteTests = framework.tests.filter(test => 
                    test.description.toLowerCase().includes('delete') ||
                    test.description.toLowerCase().includes('disabled') ||
                    test.description.toLowerCase().includes('remove')
                );
                
                console.log(`üß™ Running ${softDeleteTests.length} soft delete tests...\n`);
                
                for (const test of softDeleteTests) {
                    try {
                        console.log(`üî∏ Running: ${test.description}`);
                        await test.testFn();
                        console.log(`‚úÖ PASSED: ${test.description}`);
                    } catch (error) {
                        console.error(`‚ùå FAILED: ${test.description}`);
                        console.error(`   Error: ${error.message}`);
                    }
                }
                
                updateTestStatus('passed', 'Soft delete tests completed');
            } catch (error) {
                updateTestStatus('failed', `Soft delete tests failed: ${error.message}`);
            } finally {
                showLoader(false);
                restoreConsoleOutput();
            }
        }
        
        function clearOutput() {
            document.getElementById('testOutput').textContent = 'Output cleared. Ready to run tests...';
            updateTestStatus('idle', 'Ready to run tests');
        }
        
        function showError(message) {
            document.getElementById('testOutput').textContent = `‚ùå Error: ${message}`;
            updateTestStatus('failed', message);
        }
        
        function updateTestStatus(status, message) {
            const statusEl = document.getElementById('testStatus');
            statusEl.className = `test-status status-${status}`;
            statusEl.innerHTML = `<strong>Status:</strong> ${message}`;
        }
        
        function showLoader(show) {
            const loader = document.getElementById('testLoader');
            loader.style.display = show ? 'block' : 'none';
        }
        
        // Console output capture
        let originalConsole = {};
        
        function captureConsoleOutput() {
            const outputEl = document.getElementById('testOutput');
            outputEl.textContent = '';
            
            originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn
            };
            
            console.log = (...args) => {
                outputEl.textContent += args.join(' ') + '\n';
                outputEl.scrollTop = outputEl.scrollHeight;
                originalConsole.log(...args);
            };
            
            console.error = (...args) => {
                outputEl.textContent += args.join(' ') + '\n';
                outputEl.scrollTop = outputEl.scrollHeight;
                originalConsole.error(...args);
            };
            
            console.warn = (...args) => {
                outputEl.textContent += args.join(' ') + '\n';
                outputEl.scrollTop = outputEl.scrollHeight;
                originalConsole.warn(...args);
            };
        }
        
        function restoreConsoleOutput() {
            console.log = originalConsole.log;
            console.error = originalConsole.error;
            console.warn = originalConsole.warn;
        }
        
        // Initialize
        loadTests();
    </script>
</body>
</html>