<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GridDataRow Test - Dual State Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .controls {
            margin-bottom: 15px;
        }
        .btn {
            padding: 8px 16px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #e9ecef;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>GridDataRow - Dual State Dynamic Form</h1>
    <p>Schema-driven form with dual states: <strong>Read-Only</strong> (edit/delete buttons) and <strong>Editable</strong> (save/cancel buttons)</p>
    
    <div class="test-section">
        <h2>üìñ Read-Only State Example</h2>
        <p>Shows field values with edit ‚úèÔ∏è and delete üóëÔ∏è emoji buttons</p>
        <div class="controls">
            <button class="btn btn-primary" onclick="createReadOnlyExample()">Show Read-Only Form</button>
            <button class="btn btn-secondary" onclick="clearReadOnly()">Clear</button>
        </div>
        <div id="readonly-container"></div>
        <div id="readonly-status" class="status">Ready to create read-only form...</div>
    </div>

    <div class="test-section">
        <h2>‚úèÔ∏è Editable State Example</h2>
        <p>Shows form inputs with save üíæ and cancel ‚ùå emoji buttons</p>
        <div class="controls">
            <button class="btn btn-primary" onclick="createEditableExample()">Show Editable Form</button>
            <button class="btn btn-secondary" onclick="clearEditable()">Clear</button>
        </div>
        <div id="editable-container"></div>
        <div id="editable-status" class="status">Ready to create editable form...</div>
    </div>

    <div class="test-section">
        <h2>üîÑ Dynamic State Switching</h2>
        <p>Toggle between read-only and editable modes dynamically</p>
        <div class="controls">
            <button class="btn btn-success" onclick="createSwitchableExample()">Create Switchable Form</button>
            <button class="btn btn-primary" onclick="toggleState()">Toggle Read-Only ‚Üî Editable</button>
            <button class="btn btn-secondary" onclick="clearSwitchable()">Clear</button>
        </div>
        <div id="switchable-container"></div>
        <div id="switchable-status" class="status">Ready to create switchable form...</div>
    </div>

    <div class="test-section">
        <h2>üìã Field Type Mapping</h2>
        <ul>
            <li><strong>Position:</strong> Input text field</li>
            <li><strong>Company:</strong> Select dropdown with company options</li>
            <li><strong>Email:</strong> Input email field with validation</li>
            <li><strong>Cell Phone:</strong> Input tel field</li>
            <li><strong>Office Phone:</strong> Input tel field</li>
            <li><strong>Initial Contact:</strong> Label field (always read-only)</li>
            <li><strong>Last Contact:</strong> Date picker field</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üìä Live Form Data</h2>
        <div id="recordEditor"></div>
        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
            <h4>Current Form Data:</h4>
            <pre id="formData" style="margin: 0; font-size: 12px;"></pre>
        </div>
    </div>

    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>Form Data (Live Update):</h3>
        <pre id="formData"></pre>
    </div>

    <!-- Load data and component -->
    <script src="./positions-data.js"></script>
    <script type="module" src="./dist/griddatarow.js"></script>

    <script type="module">
        import { GridDataRow } from './dist/griddatarow.js';

        let readOnlyForm = null;
        let editableForm = null;
        let switchableForm = null;
        let currentGridDataRow = null;
        let isCurrentlyEditable = false;

        // Wait for data to load
        setTimeout(() => {
            if (window.dataGridData) {
                console.log('Data loaded successfully');
                
                // Create the original form for the live data section
                createOriginalForm();
                
                // Make functions available globally
                window.createReadOnlyExample = createReadOnlyExample;
                window.clearReadOnly = clearReadOnly;
                window.createEditableExample = createEditableExample;
                window.clearEditable = clearEditable;
                window.createSwitchableExample = createSwitchableExample;
                window.toggleState = toggleState;
                window.clearSwitchable = clearSwitchable;
                
            } else {
                console.error('No dataGridData available');
            }
        }, 100);

        function createOriginalForm() {
            console.log('Creating original GridDataRow for first record...');
            
            // Create the form for the first record (editable by default)
            currentGridDataRow = GridDataRow.createFromFirstRecord(
                window.dataGridData,
                getCompanyOptions(),
                true // Start in editable mode
            );

            // Add custom callbacks for the original form
            currentGridDataRow.config.onSave = function(data) {
                updateFormData();
                console.log('Original form saved:', data);
            };

            // Add to page
            const container = document.getElementById('recordEditor');
            container.appendChild(currentGridDataRow.getElement());

            // Setup live form data display
            setupLiveFormData();
        }

        function createReadOnlyExample() {
            try {
                readOnlyForm = GridDataRow.createFromFirstRecord(
                    window.dataGridData,
                    getCompanyOptions(),
                    false // Read-only mode
                );

                // Add custom callbacks
                readOnlyForm.config.onEdit = function() {
                    updateStatus('readonly-status', 'Edit button clicked! üéØ');
                };
                readOnlyForm.config.onDelete = function() {
                    updateStatus('readonly-status', 'Delete button clicked! ‚ö†Ô∏è');
                };

                const container = document.getElementById('readonly-container');
                container.innerHTML = '';
                container.appendChild(readOnlyForm.getElement());
                updateStatus('readonly-status', '‚úÖ Read-only form created - shows edit/delete emoji buttons');
            } catch (error) {
                updateStatus('readonly-status', '‚ùå Error: ' + error.message);
                console.error(error);
            }
        }

        function clearReadOnly() {
            document.getElementById('readonly-container').innerHTML = '';
            updateStatus('readonly-status', 'üßπ Cleared - ready to create new form');
            readOnlyForm = null;
        }

        function createEditableExample() {
            try {
                editableForm = GridDataRow.createFromFirstRecord(
                    window.dataGridData,
                    getCompanyOptions(),
                    true // Editable mode
                );

                // Add custom callbacks
                editableForm.config.onSave = function(data) {
                    updateStatus('editable-status', 'üíæ Save button clicked! Data updated.');
                };
                editableForm.config.onCancel = function() {
                    updateStatus('editable-status', '‚ùå Cancel button clicked! Changes discarded.');
                };

                const container = document.getElementById('editable-container');
                container.innerHTML = '';
                container.appendChild(editableForm.getElement());
                updateStatus('editable-status', '‚úÖ Editable form created - shows save/cancel emoji buttons');
            } catch (error) {
                updateStatus('editable-status', '‚ùå Error: ' + error.message);
                console.error(error);
            }
        }

        function clearEditable() {
            document.getElementById('editable-container').innerHTML = '';
            updateStatus('editable-status', 'üßπ Cleared - ready to create new form');
            editableForm = null;
        }

        function createSwitchableExample() {
            try {
                isCurrentlyEditable = false; // Start in read-only mode
                switchableForm = GridDataRow.createFromFirstRecord(
                    window.dataGridData,
                    getCompanyOptions(),
                    isCurrentlyEditable
                );

                // Add smart callbacks that handle state switching
                switchableForm.config.onEdit = function() {
                    updateStatus('switchable-status', '‚úèÔ∏è Edit clicked - switching to editable mode...');
                    isCurrentlyEditable = true;
                    switchableForm.setEditable(true);
                    setTimeout(() => {
                        updateStatus('switchable-status', '‚úÖ Now in editable mode - shows save/cancel buttons');
                    }, 100);
                };

                switchableForm.config.onDelete = function() {
                    if (confirm('Are you sure you want to delete this record?')) {
                        updateStatus('switchable-status', 'üóëÔ∏è Delete confirmed - record would be deleted');
                    } else {
                        updateStatus('switchable-status', 'üõ°Ô∏è Delete cancelled by user');
                    }
                };

                switchableForm.config.onSave = function(data) {
                    updateStatus('switchable-status', 'üíæ Save clicked - switching back to read-only mode...');
                    isCurrentlyEditable = false;
                    switchableForm.setEditable(false);
                    setTimeout(() => {
                        updateStatus('switchable-status', '‚úÖ Saved and switched to read-only mode');
                    }, 100);
                };

                switchableForm.config.onCancel = function() {
                    updateStatus('switchable-status', '‚ùå Cancel clicked - reverting to read-only mode...');
                    isCurrentlyEditable = false;
                    switchableForm.setEditable(false);
                    setTimeout(() => {
                        updateStatus('switchable-status', 'üîô Cancelled and back to read-only mode');
                    }, 100);
                };

                const container = document.getElementById('switchable-container');
                container.innerHTML = '';
                container.appendChild(switchableForm.getElement());
                updateStatus('switchable-status', '‚úÖ Switchable form created - currently in read-only mode');
            } catch (error) {
                updateStatus('switchable-status', '‚ùå Error: ' + error.message);
                console.error(error);
            }
        }

        function toggleState() {
            if (switchableForm) {
                isCurrentlyEditable = !isCurrentlyEditable;
                switchableForm.setEditable(isCurrentlyEditable);
                updateStatus('switchable-status', 
                    `üîÑ Toggled to ${isCurrentlyEditable ? 'editable' : 'read-only'} mode`);
            } else {
                updateStatus('switchable-status', '‚ö†Ô∏è No form to toggle - create one first');
            }
        }

        function clearSwitchable() {
            document.getElementById('switchable-container').innerHTML = '';
            updateStatus('switchable-status', 'üßπ Cleared - ready to create new form');
            switchableForm = null;
            isCurrentlyEditable = false;
        }

        function setupLiveFormData() {
            const updateFormData = () => {
                if (currentGridDataRow) {
                    document.getElementById('formData').textContent = 
                        JSON.stringify(currentGridDataRow.getData(), null, 2);
                }
            };

            // Initial display
            updateFormData();

            // Update display when form changes
            const container = document.getElementById('recordEditor');
            const observer = new MutationObserver(() => {
                // Re-attach listeners when form is re-rendered
                const inputs = container.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.removeEventListener('input', updateFormData);
                    input.removeEventListener('change', updateFormData);
                    input.addEventListener('input', updateFormData);
                    input.addEventListener('change', updateFormData);
                });
                updateFormData();
            });
            observer.observe(container, { childList: true, subtree: true });
        }

        function updateStatus(elementId, message) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.style.background = '#d4edda';
            statusEl.style.color = '#155724';
            setTimeout(() => {
                statusEl.style.background = '#e9ecef';
                statusEl.style.color = '#333';
            }, 3000);
        }

        function getCompanyOptions() {
            return [
                'TechCorp Inc',
                'InnovateSoft', 
                'DataDrive Systems',
                'CloudFirst Technologies',
                'NextGen Solutions',
                'DesignWorks Studio',
                'ServerTech Corp',
                'TestPro Solutions',
                'AI Innovations Ltd',
                'SecureNet Corp'
            ];
        }

        console.log('GridDataRow dual-state test page loaded successfully');
    </script>
</body>
</html>