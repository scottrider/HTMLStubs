<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Mechanism Demo - Loosely Coupled Design</title>
</head>
<body>
    <h1>Edit Mechanism Applied to Existing DataGrid</h1>
    <p>This demonstrates the loosely coupled design where editing is a separate mechanism applied to existing grids.</p>
    
    <!-- Original PositionsDataGrid - unchanged -->
    <positions-data-grid 
        id="testGrid"
        cssClass="test-grid">
    </positions-data-grid>
    
    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border: 1px solid #ccc;">
        <h3>External Controls (demonstrates loose coupling)</h3>
        <button onclick="window.gridEditMechanism?.enableEditing()">Enable Editing</button>
        <button onclick="window.gridEditMechanism?.disableEditing()">Disable Editing</button>
        <button onclick="window.gridEditMechanism?.lockEditing()">Lock Editing</button>
        <br><br>
        <em>The edit mechanism is completely separate from the grid - loosely coupled design!</em>
    </div>
    
    <!-- Load original components unchanged -->
    <script src="./positions-data.js"></script>
    <script type="module" src="./dist/datagrid.js"></script>
    <script type="module" src="./dist/positionsdatagrid.js"></script>
    
    <!-- Load edit mechanism separately -->
    <script type="module" src="./dist/editmechanism.js"></script>
    <script type="module" src="./dist/editintegration.js"></script>
    
    <script type="module">
        import { enableEditingOnPositionsGrid } from './dist/editintegration.js';
        
        // Initialize the original grid first (unchanged)
        setTimeout(() => {
            const grid = document.getElementById('testGrid');
            
            if (window.dataGridData && grid) {
                console.log('Loading data into original PositionsDataGrid...');
                grid.sourceData = window.dataGridData;
                console.log('Original grid loaded successfully');
                
                // Now apply the edit mechanism separately (loosely coupled)
                enableEditingOnPositionsGrid();
            }
        }, 100);
        
        // Listen for edit events
        document.addEventListener('row-data-updated', (e) => {
            console.log('External listener caught row update:', e.detail);
        });
    </script>
</body>
</html>